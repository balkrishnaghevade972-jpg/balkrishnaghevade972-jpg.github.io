<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mother's Diet Planner</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>üíó</text></svg>">
<style>
:root{
  --pink:#c6536b; --pink-dark:#a03b51; --bg:#fff7f8; --card:#fff;
  --accent:#fff0f3; --text:#3d1f28;
  --muted:#6b5b63;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:Inter, system-ui, Arial, sans-serif; background:var(--bg);
  color:var(--text); -webkit-font-smoothing:antialiased;
}
.header{
  padding:14px 18px; display:flex; gap:12px; align-items:center; justify-content:space-between;
  background: linear-gradient(90deg,#fff7f8, #fffafc);
  border-bottom:1px solid rgba(0,0,0,0.03);
}
.brand { display:flex; gap:12px; align-items:center; }
.logo { width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--pink),#ff7b9a);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700; }
.title { font-size:18px; font-weight:700; }
.controls-right { display:flex; gap:8px; align-items:center; }
.lang-btn { padding:8px 12px; border:none; border-radius:10px; background:var(--pink); color:#fff; cursor:pointer; }
.install-btn { padding:8px 12px; border-radius:10px; border:1px solid rgba(0,0,0,0.06); background:transparent; cursor:pointer; }

.container{ max-width:1000px; margin:18px auto; padding:12px; }
.grid{ display:grid; grid-template-columns:1fr 360px; gap:18px; align-items:start; }
@media (max-width:920px){ .grid{ grid-template-columns:1fr; } }

.card{ background:var(--card); padding:18px; border-radius:14px; box-shadow:0 8px 30px rgba(0,0,0,0.06); }
.section-title{ font-weight:700; color:var(--pink); margin-bottom:10px; }

.table{ width:100%; border-collapse:collapse; }
.table th{ padding:10px; background:var(--accent); color:var(--pink-dark); text-align:left; border-radius:6px; }
.table td{ padding:10px; border-bottom:1px solid #f3e8ea; vertical-align:top; font-size:14px; }

.plan-list{ display:flex; flex-direction:column; gap:8px; margin-top:8px; }
.plan-item{ display:flex; justify-content:space-between; gap:12px; background:linear-gradient(90deg,#fff0f3,#fff7f9); padding:12px; border-radius:10px; align-items:center; }
.plan-time{ font-weight:700; color:#7a2b3b; width:90px; }
.plan-text{ flex:1; font-size:14px; }

.controls{ display:flex; gap:8px; margin-top:12px; flex-wrap:wrap; }
.input, select{ padding:10px; border-radius:10px; border:1px solid rgba(0,0,0,0.08); min-width:120px; }
.primary{ background:var(--pink); color:#fff; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; }
.ghost{ background:transparent; border:1px solid rgba(0,0,0,0.06); padding:10px 12px; border-radius:10px; cursor:pointer; }

#reminder-popup{
  position:fixed; right:18px; bottom:18px; width:320px; max-width:92%;
  background:#fff; border-radius:12px; padding:14px; box-shadow:0 10px 30px rgba(0,0,0,0.18);
  display:none; transform:translateY(20px); opacity:0; z-index:9999;
  border-left:6px solid var(--pink);
}
#reminder-popup.show{ display:block; animation:popin .45s forwards; }
@keyframes popin { to{ transform:none; opacity:1; } }

.small{ font-size:13px; color:var(--muted); }
.footer-note{ font-size:12px; color:var(--muted); margin-top:10px; }

.btn-inline{ background:transparent; border: none; color: var(--pink); cursor:pointer; text-decoration:underline; padding:0; font-weight:700; }
.badge { background:var(--accent); padding:6px 8px; border-radius:8px; color:var(--pink-dark); font-weight:700; display:inline-block; }
</style>
</head>
<body>

<header class="header">
  <div class="brand">
    <div class="logo">MD</div>
    <div>
      <div class="title" id="appTitle">Mother's Diet Planner</div>
      <div class="small" id="appSubtitle">Daily planner ‚Ä¢ Reminders ‚Ä¢ Installable</div>
    </div>
  </div>

  <div class="controls-right">
    <div class="badge" id="langBadge">EN</div>
    <button class="lang-btn" id="langBtn">üåê Switch</button>
    <button class="install-btn" id="installBtn" style="display:none">‚ûï Install</button>
  </div>
</header>

<main class="container">
  <div class="grid">
    <!-- LEFT -->
    <section class="card" id="leftCard">
      <div class="section-title" id="dietTitle">Diet Specifications</div>

      <table class="table" aria-labelledby="dietTitle">
        <thead>
          <tr><th id="stageCol">Stage</th><th id="recoCol">Recommendations</th></tr>
        </thead>
        <tbody>
          <tr>
            <td id="beforeTitle"><strong>Before Pregnancy</strong></td>
            <td id="beforeText">‚Ä¢ Folate-rich foods (spinach, legumes)<br>‚Ä¢ Whole grains & millets<br>‚Ä¢ Nuts, seeds, healthy fats<br>‚Ä¢ Protein foods (eggs, chicken, dal)<br>‚Ä¢ Balanced calcium & iron</td>
          </tr>
          <tr>
            <td id="duringTitle"><strong>During Pregnancy</strong></td>
            <td id="duringText">‚Ä¢ Add ~350 calories (2nd & 3rd trimester)<br>‚Ä¢ Vegetables (300g), fruits (150g)<br>‚Ä¢ Pulses (80g), nuts (40g), dairy (400 ml)<br>‚Ä¢ Lean meat/fish or plant protein</td>
          </tr>
          <tr>
            <td id="afterTitle"><strong>Postpartum</strong></td>
            <td id="afterText">‚Ä¢ High-protein meals<br>‚Ä¢ Iron-rich foods<br>‚Ä¢ Hydration (water, soups)<br>‚Ä¢ Healthy fats (nuts, ghee)<br>‚Ä¢ Small frequent meals for breastfeeding</td>
          </tr>
        </tbody>
      </table>

      <div class="section-title" style="margin-top:16px" id="plannerTitle">Full Daily Diet Planner</div>
      <div class="small" id="plannerHint">Tap a meal to see details and play the reminder sound.</div>

      <div class="plan-list" id="planList" style="margin-top:12px"></div>

      <div class="controls" style="margin-top:12px">
        <select id="preset" class="input">
          <option value="pregnancy">Pregnancy ‚Äî Balanced</option>
          <option value="postpartum">Postpartum ‚Äî Lactation</option>
          <option value="preconception">Pre-Conception ‚Äî Preparation</option>
        </select>

        <label style="display:flex;align-items:center;gap:8px">
          <input type="checkbox" id="autoRemind"> <span id="autoRemindLabel">Auto reminders</span>
        </label>

        <select id="intervalSelect" class="input">
          <option value="120">Reminder every 2 hours</option>
          <option value="60">Every 1 hour</option>
          <option value="180">Every 3 hours</option>
          <option value="custom">Custom (minutes)</option>
        </select>

        <input id="customInterval" class="input" type="number" min="15" placeholder="minutes" style="display:none; width:130px">
        <button class="primary" id="applyPreset">Apply Preset</button>
      </div>

      <div class="footer-note" id="tipNote">Tip: Keep the page open (or install as PWA) for scheduled reminders. For background push (when closed), you will require a push server.</div>
    </section>

    <!-- RIGHT -->
    <aside class="card">
      <div class="section-title" id="quickTitle">Quick Controls</div>

      <div style="display:flex;flex-direction:column;gap:8px">
        <label class="small" id="weightLabel">Weight (kg)</label>
        <input id="weightInput" class="input" type="number" min="30" placeholder="e.g. 58">

        <label class="small" id="pickLangLabel">Pick language</label>
        <select id="langSelect" class="input">
          <option value="en">English</option>
          <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
        </select>

        <button class="primary" id="saveBtn">Save Settings</button>
        <button class="ghost" id="showNow">Show Reminder Now</button>

        <div style="height:8px"></div>
        <div class="small" id="volumeLabel">Sound volume</div>
        <input type="range" id="volume" min="0" max="1" step="0.05" value="0.8">

        <div style="margin-top:12px" class="small" id="nextLabel">Next reminder in: <span id="nextIn">‚Äî</span></div>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid #f3e8ea">
      <div class="small" id="notesText"><strong>PWA / Push notes</strong><br>‚Ä¢ To receive notifications when the site is closed you will need a push server (I can provide a Node.js example).</div>
    </aside>
  </div>
</main>

<div id="reminder-popup" role="status" aria-live="polite"></div>

<script>
/* ============================
   TRANSLATIONS (English + FORMAL Marathi)
   ============================ */
let currentLang = 'en';

const translations = {
  en: {
    appTitle: "Mother's Diet Planner",
    appSubtitle: "Daily planner ‚Ä¢ Reminders ‚Ä¢ Installable",
    dietTitle: "Diet Specifications",
    plannerTitle: "Full Daily Diet Planner",
    plannerHint: "Tap a meal to see details and play the reminder sound.",
    autoRemindLabel: "Auto reminders",
    tipNote: "Tip: Keep the page open (or install as PWA) for scheduled reminders. For background push (when closed), you will require a push server.",
    quickTitle: "Quick Controls",
    weightLabel: "Weight (kg)",
    pickLangLabel: "Pick language",
    saveBtn: "Save Settings",
    showNow: "Show Reminder Now",
    volumeLabel: "Sound volume",
    nextLabel: "Next reminder in:",
    notesText: "‚Ä¢ To receive notifications when the site is closed you will need a push server (I can provide a Node.js example).",
    installed: "Installed",
    not_installed: "Not installed",
    plannerApplied: "Planner applied",
    settingsSaved: "Settings saved",
    meals: {
      morning: {title: "Morning (Breakfast)", text: "Oats or poha with milk, 1 boiled egg or paneer, fruit."},
      mid: {title: "Mid-morning", text: "Fruit + handful of nuts or a smoothie."},
      lunch: {title: "Lunch", text: "Brown rice or roti, dal, mixed vegetables, salad, curd."},
      evening: {title: "Evening snack", text: "Sprout chaat or roasted chana; buttermilk."},
      dinner: {title: "Dinner", text: "Roti + vegetable + protein (fish/chicken/dal); light soup."},
      bedtime: {title: "Before bed", text: "Warm milk with a tsp of ghee (if allowed)."}
    },
    reminders: [
      "Hydrate ‚Äî drink a glass of water.",
      "Time for a healthy snack.",
      "Remember iron-rich foods today.",
      "Have a fruit for natural energy.",
      "Include protein in your next meal.",
      "Take a short walk or stretch."
    ],
    dietSpecs: {
      stage: "Stage",
      recommendations: "Recommendations",
      beforeTitle: "Before Pregnancy",
      duringTitle: "During Pregnancy",
      afterTitle: "Postpartum",
      beforeText: "‚Ä¢ Folate-rich foods (spinach, legumes)<br>‚Ä¢ Whole grains & millets<br>‚Ä¢ Nuts, seeds, healthy fats<br>‚Ä¢ Protein foods (eggs, chicken, dal)<br>‚Ä¢ Balanced calcium & iron",
      duringText: "‚Ä¢ Add ~350 calories (2nd & 3rd trimester)<br>‚Ä¢ Vegetables (300g), fruits (150g)<br>‚Ä¢ Pulses (80g), nuts (40g), dairy (400 ml)<br>‚Ä¢ Lean meat/fish or plant protein",
      afterText: "‚Ä¢ High-protein meals<br>‚Ä¢ Iron-rich foods<br>‚Ä¢ Hydration (water, soups)<br>‚Ä¢ Healthy fats (nuts, ghee)<br>‚Ä¢ Small frequent meals for breastfeeding"
    }
  },

  mr: {
    appTitle: "‡§Ü‡§à‡§Ç‡§ö‡•á ‡§Ü‡§π‡§æ‡§∞ ‡§®‡§ø‡§Ø‡•ã‡§ú‡§®",
    appSubtitle: "‡§¶‡•à‡§®‡§Ç‡§¶‡§ø‡§® ‡§Ø‡•ã‡§ú‡§®‡§æ ‚Ä¢ ‡§∏‡•ç‡§Æ‡§∞‡§£ ‚Ä¢ ‡§á‡§®‡•ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§Ø‡•ã‡§ó‡•ç‡§Ø",
    dietTitle: "‡§Ü‡§π‡§æ‡§∞ ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§ï",
    plannerTitle: "‡§¶‡•à‡§®‡§Ç‡§¶‡§ø‡§® ‡§Ü‡§π‡§æ‡§∞ ‡§Ø‡•ã‡§ú‡§®‡§æ",
    plannerHint: "‡§è‡§ñ‡§æ‡§¶‡§æ ‡§ú‡•á‡§µ‡§£ ‡§¶‡§æ‡§¨‡§æ ‚Äî ‡§§‡§™‡§∂‡•Ä‡§≤ ‡§µ ‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§ß‡•ç‡§µ‡§®‡•Ä ‡§ê‡§ï‡§æ.",
    autoRemindLabel: "‡§∏‡•ç‡§µ‡§Ø‡§Ç‡§ö‡§≤‡§ø‡§§ ‡§∏‡•ç‡§Æ‡§∞‡§£‡•á",
    tipNote: "‡§ü‡•Ä‡§™: ‡§µ‡•á‡§≥‡§æ‡§™‡§§‡•ç‡§∞‡§ï ‡§∏‡•ç‡§Æ‡§∞‡§£‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä ‡§™‡§æ‡§® ‡§â‡§ò‡§°‡•á ‡§†‡•á‡§µ‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ PWA ‡§Æ‡•ç‡§π‡§£‡•Ç‡§® ‡§á‡§®‡•ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡§æ. ‡§™‡•É‡§∑‡•ç‡§† ‡§¨‡§Ç‡§¶ ‡§Ö‡§∏‡§§‡§æ‡§®‡§æ ‡§∏‡•ç‡§Æ‡§∞‡§£‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä push ‡§∏‡§∞‡•ç‡§µ‡•ç‡§π‡§∞ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ü‡§π‡•á.",
    quickTitle: "‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£‡•á",
    weightLabel: "‡§µ‡§ú‡§® (‡§ï‡§ø‡§≤‡•ã)",
    pickLangLabel: "‡§≠‡§æ‡§∑‡§æ ‡§®‡§ø‡§µ‡§°‡§æ",
    saveBtn: "‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó ‡§ú‡§§‡§® ‡§ï‡§∞‡§æ",
    showNow: "‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§¶‡§æ‡§ñ‡§µ‡§æ",
    volumeLabel: "‡§ß‡•ç‡§µ‡§®‡•Ä ‡§Ü‡§µ‡§æ‡§ú",
    nextLabel: "‡§™‡•Å‡§¢‡•Ä‡§≤ ‡§∏‡•ç‡§Æ‡§∞‡§£: ",
    notesText: "‚Ä¢ ‡§∏‡§æ‡§á‡§ü ‡§¨‡§Ç‡§¶ ‡§Ö‡§∏‡§§‡§æ‡§®‡§æ ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§®‡•ç‡§∏‡§∏‡§æ‡§†‡•Ä push ‡§∏‡§∞‡•ç‡§µ‡•ç‡§π‡§∞ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ö‡§∏‡§§‡•ã (Node.js ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß).",
    installed: "‡§á‡§®‡•ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡•á‡§≤‡•á",
    not_installed: "‡§á‡§®‡•ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§®‡§æ‡§π‡•Ä",
    plannerApplied: "‡§Ø‡•ã‡§ú‡§®‡§æ ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡•á‡§≤‡•Ä",
    settingsSaved: "‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó ‡§ú‡§§‡§® ‡§ï‡•á‡§≤‡•á",
    meals: {
      morning: {title: "‡§∏‡§ï‡§æ‡§≥ (‡§®‡§æ‡§∂‡•ç‡§§‡§æ)", text: "‡§¶‡•Ç‡§ß‡§æ‡§∏‡§π ‡§ì‡§ü‡•ç‡§∏/‡§™‡•ã‡§π‡•á, ‡•ß ‡§â‡§ï‡§°‡§≤‡•á‡§≤‡•á ‡§Ö‡§Ç‡§°‡•á ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§™‡§®‡•Ä‡§∞, ‡§´‡§≥."},
      mid: {title: "‡§Æ‡§ß‡§≤‡§æ ‡§®‡§æ‡§∂‡•ç‡§§‡§æ", text: "‡§´‡§≥ + ‡§•‡•ã‡§°‡•á ‡§∏‡•Å‡§ï‡§æ ‡§Æ‡•á‡§µ‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§∏‡•ç‡§Æ‡•Ç‡§¶‡•Ä."},
      lunch: {title: "‡§¶‡•Å‡§™‡§æ‡§∞‡§ö‡•á ‡§ú‡•á‡§µ‡§£", text: "‡§¨‡•ç‡§∞‡§æ‡§â‡§® ‡§≠‡§æ‡§§/‡§∞‡•ã‡§ü‡•Ä, ‡§°‡§æ‡§≥, ‡§Æ‡§ø‡§∂‡•ç‡§∞ ‡§≠‡§æ‡§ú‡•ç‡§Ø‡§æ, ‡§ï‡•ã‡§∂‡§ø‡§Ç‡§¨‡•Ä‡§∞, ‡§¶‡§π‡•Ä."},
      evening: {title: "‡§∏‡§æ‡§Ø‡§Ç‡§ï‡§æ‡§≥‡§ö‡§æ ‡§®‡§æ‡§∂‡•ç‡§§‡§æ", text: "‡§Æ‡•Ç‡§ó‡§°‡§æ‡§≥ ‡§ö‡§æ‡§ü ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§≠‡§æ‡§ú‡§≤‡•á‡§≤‡•á ‡§ö‡§£‡•á; ‡§§‡§æ‡§ï."},
      dinner: {title: "‡§∞‡§æ‡§§‡•ç‡§∞‡•Ä‡§ö‡•á ‡§ú‡•á‡§µ‡§£", text: "‡§∞‡•ã‡§ü‡•Ä + ‡§≠‡§æ‡§ú‡•ç‡§Ø‡§æ + ‡§™‡•ç‡§∞‡§•‡§ø‡§®‡•á (‡§Æ‡§æ‡§∏‡•á/‡§ö‡§ø‡§ï‡§®/‡§°‡§æ‡§≥); ‡§π‡§≤‡§ï‡§æ ‡§∏‡•Ç‡§™."},
      bedtime: {title: "‡§ù‡•ã‡§™‡§£‡•ç‡§Ø‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡•Ä", text: "‡§ó‡§∞‡§Æ ‡§¶‡•Ç‡§ß ‡§µ ‡•ß tsp ‡§§‡•Ç‡§™ (‡§ú‡§∞ ‡§™‡§∞‡§µ‡§æ‡§®‡§ó‡•Ä ‡§Ö‡§∏‡•á‡§≤ ‡§§‡§∞)."}
    },
    reminders: [
      "‡§™‡§æ‡§£‡•Ä ‡§™‡•ç‡§Ø‡§æ ‚Äî ‡§è‡§ï ‡§ó‡•ç‡§≤‡§æ‡§∏ ‡§™‡§æ‡§£‡•Ä.",
      "‡§π‡•á‡§≤‡•ç‡§¶‡•Ä ‡§∏‡•ç‡§®‡•Ö‡§ï ‡§ò‡•á‡§£‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§µ‡•á‡§≥.",
      "‡§Ü‡§ú ‡§≤‡•ã‡§π‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§™‡§¶‡§æ‡§∞‡•ç‡§• ‡§≤‡§ï‡•ç‡§∑‡§æ‡§§ ‡§†‡•á‡§µ‡§æ.",
      "‡§ä‡§∞‡•ç‡§ú‡•á‡§∏‡§æ‡§†‡•Ä ‡§´‡§≥ ‡§ñ‡§æ.",
      "‡§™‡•Å‡§¢‡•Ä‡§≤ ‡§ú‡•á‡§µ‡§£‡§æ‡§§ ‡§™‡•ç‡§∞‡§•‡§ø‡§®‡•á ‡§∏‡§Æ‡§æ‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ.",
      "‡§•‡•ã‡§°‡•á ‡§ö‡§æ‡§≤‡•Ç‡§® ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§ö ‡§ï‡§∞‡§æ."
    ],
    dietSpecs: {
      stage: "‡§ü‡§™‡•ç‡§™‡§æ",
      recommendations: "‡§∏‡•Ç‡§ö‡§®‡§æ",
      beforeTitle: "‡§ó‡§∞‡•ç‡§≠‡§ß‡§æ‡§∞‡§£‡•á‡§™‡•Ç‡§∞‡•ç‡§µ‡•Ä",
      duringTitle: "‡§ó‡§∞‡•ç‡§≠‡§ß‡§æ‡§∞‡§£‡•á‡§¶‡§∞‡§Æ‡•ç‡§Ø‡§æ‡§®",
      afterTitle: "‡§™‡•ç‡§∞‡§∏‡•Ç‡§§‡•Ä‡§®‡§Ç‡§§‡§∞",
      beforeText: "‚Ä¢ ‡§´‡•ã‡§≤‡•á‡§ü‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§Ö‡§®‡•ç‡§® (‡§™‡§æ‡§≤‡§ï, ‡§ï‡§°‡§ß‡§æ‡§®‡•ç‡§Ø‡•á)<br>‚Ä¢ ‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ß‡§æ‡§®‡•ç‡§Ø‡•á ‡§µ ‡§¨‡§æ‡§ú‡§∞‡•Ä<br>‚Ä¢ ‡§∏‡•Å‡§ï‡§æ ‡§Æ‡•á‡§µ‡§æ, ‡§¨‡§ø‡§Ø‡§æ, ‡§π‡•á‡§≤‡•ç‡§¶‡•Ä ‡§´‡•Ö‡§ü‡•ç‡§∏<br>‚Ä¢ ‡§™‡•ç‡§∞‡§•‡§ø‡§®‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§Ö‡§®‡•ç‡§® (‡§Ö‡§Ç‡§°‡•Ä, ‡§ö‡§ø‡§ï‡§®, ‡§°‡§æ‡§≥)<br>‚Ä¢ ‡§ï‡•Ö‡§≤‡•ç‡§∂‡§ø‡§Ø‡§Æ ‡§µ ‡§≤‡•ã‡§π ‡§∏‡§Ç‡§§‡•Å‡§≤‡§ø‡§§ ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§æ‡§§",
      duringText: "‚Ä¢ ‡§¶‡•Å‡§∏‡§±‡•ç‡§Ø‡§æ ‡§µ ‡§§‡§ø‡§∏‡§±‡•ç‡§Ø‡§æ ‡§§‡§ø‡§Æ‡§æ‡§π‡•Ä‡§§ ~350 ‡§ï‡•Ö‡§≤‡§∞‡•Ä‡§ú ‡§µ‡§æ‡§¢‡§µ‡§æ<br>‚Ä¢ ‡§≠‡§æ‡§ú‡•ç‡§Ø‡§æ (300g), ‡§´‡§≥‡•á (150g)<br>‚Ä¢ ‡§°‡§æ‡§≥‡•Ä (80g), ‡§∏‡•Å‡§ï‡§æ ‡§Æ‡•á‡§µ‡§æ (40g), ‡§¶‡•Å‡§ó‡•ç‡§ß (400 ml)<br>‚Ä¢ ‡§Æ‡§æ‡§∏‡•á/‡§ö‡§ø‡§ï‡§® ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§µ‡§®‡§∏‡•ç‡§™‡§§‡•Ä-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§™‡•ç‡§∞‡§•‡§ø‡§®‡•á",
      afterText: "‚Ä¢ ‡§™‡•ç‡§∞‡§•‡§ø‡§®‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§ú‡•á‡§µ‡§£<br>‚Ä¢ ‡§≤‡•ã‡§π‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§Ö‡§®‡•ç‡§®<br>‚Ä¢ ‡§π‡§æ‡§Ø‡§°‡•ç‡§∞‡•á‡§∂‡§® (‡§™‡§æ‡§£‡•Ä, ‡§∏‡•Ç‡§™)<br>‚Ä¢ ‡§π‡•á‡§≤‡•ç‡§¶‡•Ä ‡§´‡•Ö‡§ü‡•ç‡§∏ (‡§§‡•Ç‡§™, ‡§∏‡•Å‡§ï‡§æ ‡§Æ‡•á‡§µ‡§æ)<br>‚Ä¢ ‡§∏‡•ç‡§§‡§®‡§™‡§æ‡§®‡§æ‡§∏‡§æ‡§†‡•Ä ‡§õ‡•ã‡§ü‡•á ‡§µ ‡§µ‡§æ‡§∞‡§Ç‡§µ‡§æ‡§∞ ‡§ú‡•á‡§µ‡§£"
    }
  }
};

/* ============================
   RENDERING FUNCTIONS
   ============================ */
function renderPlanner(){
  const list = document.getElementById('planList');
  list.innerHTML = '';
  const mealOrder = ['morning','mid','lunch','evening','dinner','bedtime'];
  mealOrder.forEach(key=>{
    const meal = translations[currentLang].meals[key];
    const div = document.createElement('div');
    div.className = 'plan-item';
    div.innerHTML = `<div class="plan-time">${meal.title}</div>
                     <div class="plan-text">${meal.text}</div>
                     <div><button class="ghost" onclick="playMeal('${key}')">${currentLang==='mr' ? 'üîî' : 'üîî'}</button></div>`;
    list.appendChild(div);
  });

  // Update UI text
  document.getElementById('appTitle').innerText = translations[currentLang].appTitle;
  document.getElementById('appSubtitle').innerText = translations[currentLang].appSubtitle;
  document.getElementById('dietTitle').innerText = translations[currentLang].dietTitle;
  document.getElementById('plannerTitle').innerText = translations[currentLang].plannerTitle;
  document.getElementById('plannerHint').innerText = translations[currentLang].plannerHint;
  document.getElementById('autoRemindLabel').innerText = translations[currentLang].autoRemindLabel;
  document.getElementById('tipNote').innerText = translations[currentLang].tipNote;
  document.getElementById('quickTitle').innerText = translations[currentLang].quickTitle;
  document.getElementById('weightLabel').innerText = translations[currentLang].weightLabel;
  document.getElementById('pickLangLabel').innerText = translations[currentLang].pickLangLabel;
  document.getElementById('saveBtn').innerText = translations[currentLang].saveBtn;
  document.getElementById('showNow').innerText = translations[currentLang].showNow;
  document.getElementById('volumeLabel').innerText = translations[currentLang].volumeLabel;
  document.getElementById('nextLabel').innerHTML = translations[currentLang].nextLabel + ' <span id="nextIn">‚Äî</span>';
  document.getElementById('notesText').innerText = translations[currentLang].notesText;

  renderDietSpecs();
}

function renderDietSpecs(){
  const t = translations[currentLang].dietSpecs;
  document.getElementById('stageCol').innerText = t.stage;
  document.getElementById('recoCol').innerText = t.recommendations;
  document.getElementById('beforeTitle').innerHTML = `<strong>${t.beforeTitle}</strong>`;
  document.getElementById('duringTitle').innerHTML = `<strong>${t.duringTitle}</strong>`;
  document.getElementById('afterTitle').innerHTML = `<strong>${t.afterTitle}</strong>`;
  document.getElementById('beforeText').innerHTML = t.beforeText;
  document.getElementById('duringText').innerHTML = t.duringText;
  document.getElementById('afterText').innerHTML = t.afterText;
}

/* ============================
   WEB AUDIO (Soft Ding)
   ============================ */
let audioCtx, masterGain;
function initAudio(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  masterGain = audioCtx.createGain();
  masterGain.connect(audioCtx.destination);
  const savedVol = parseFloat(localStorage.getItem('md_vol'));
  masterGain.gain.value = isNaN(savedVol) ? parseFloat(document.getElementById('volume').value) : savedVol;
}
function playDing(){
  try{
    initAudio();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.setValueAtTime(880, audioCtx.currentTime);
    g.gain.setValueAtTime(0, audioCtx.currentTime);
    g.gain.linearRampToValueAtTime(0.18, audioCtx.currentTime + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.55);
    o.connect(g); g.connect(masterGain);
    o.start(); o.stop(audioCtx.currentTime + 0.55);
  }catch(e){ console.warn('Audio failed', e); }
}
function setVolume(v){
  if(masterGain) masterGain.gain.value = v;
  localStorage.setItem('md_vol', v);
}

/* ============================
   POPUP & BROWSER NOTIFICATIONS
   ============================ */
function getRandomReminder(){
  const arr = translations[currentLang].reminders;
  return arr[Math.floor(Math.random()*arr.length)];
}
function showPopup(message){
  const popup = document.getElementById('reminder-popup');
  popup.textContent = message;
  popup.classList.add('show');
  popup.style.display = 'block';
  playDing();

  // browser notification
  if('Notification' in window && Notification.permission === 'granted'){
    if(navigator.serviceWorker && navigator.serviceWorker.controller){
      navigator.serviceWorker.controller.postMessage({type:'show-notification', body: message});
    } else {
      new Notification(translations[currentLang].appTitle, { body: message });
    }
  }

  setTimeout(()=>{ popup.classList.remove('show'); popup.style.display='none'; }, 6000);
}

/* ============================
   REMINDER SCHEDULER (persistent)
   ============================ */
let reminderTimer = null;
let reminderTimeout = null;
let reminderIntervalMinutes = 120;

function triggerReminder(){
  const message = getRandomReminder();
  showPopup(message);
  localStorage.setItem('md_lastReminder', Date.now());
  updateNextCountdown(reminderIntervalMinutes * 60000);
}

function scheduleRemindersFromState(){
  // clear existing
  if(reminderTimer){ clearInterval(reminderTimer); reminderTimer = null; }
  if(reminderTimeout){ clearTimeout(reminderTimeout); reminderTimeout = null; }

  const auto = (localStorage.getItem('md_auto') === '1');
  if(!auto) return;

  // interval
  const savedInterval = parseInt(localStorage.getItem('md_interval')) || 120;
  reminderIntervalMinutes = savedInterval;

  const lastTs = parseInt(localStorage.getItem('md_lastReminder')) || null;
  const now = Date.now();
  const intervalMs = reminderIntervalMinutes * 60000;

  if(!lastTs){
    // schedule first in full interval
    reminderTimeout = setTimeout(()=>{
      triggerReminder();
      reminderTimer = setInterval(triggerReminder, intervalMs);
    }, intervalMs);
    updateNextCountdown(intervalMs);
    return;
  }

  const elapsed = now - lastTs;
  if(elapsed >= intervalMs){
    // missed while closed -> trigger immediately and start interval
    triggerReminder();
    reminderTimer = setInterval(triggerReminder, intervalMs);
    updateNextCountdown(intervalMs);
  } else {
    // schedule remaining
    const remaining = interva
